# 定时提醒小助手 - 待办详情和编辑UI设计

## 1. 概述

本文档描述待办详情和编辑功能的UI设计，包括弹窗形式的详情展示、编辑表单和交互逻辑。

## 2. 页面结构

### 2.1 待办详情弹窗

```
┌─────────────────────────────────────────┐
│ ┌─ Header ────────────────────────────┐ │
│ │ [×] 待办详情           [编辑] [更多] │ │
│ └─────────────────────────────────────┘ │
│ ┌─ Content ──────────────────────────┐  │
│ │ 标题: 重要会议                      │  │
│ │ 内容: 讨论项目进度...               │  │
│ │ 时间: 2024-01-15 14:00             │  │
│ │ 优先级: [高优先级]                  │  │
│ │ 分类: [工作]                       │  │
│ │ 状态: [待完成]                     │  │
│ │ 标签: [重要] [会议]                │  │
│ └─────────────────────────────────────┘ │
│ ┌─ Actions ──────────────────────────┐  │
│ │ [完成] [推迟] [编辑] [删除]         │  │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 2.2 编辑表单

```
┌─────────────────────────────────────────┐
│ ┌─ Header ────────────────────────────┐ │
│ │ [←] 编辑待办           [保存] [取消] │ │
│ └─────────────────────────────────────┘ │
│ ┌─ Form Fields ──────────────────────┐  │
│ │ 标题: [_________________]           │  │
│ │ 内容: [                          ] │  │
│ │       [                          ] │  │
│ │ 时间: [2024-01-15] [14:00]         │  │
│ │ 优先级: ○低 ○普通 ●高 ○紧急        │  │
│ │ 分类: [工作 ▼]                     │  │
│ │ 标签: [重要] [会议] [+添加]         │  │
│ │ 提醒: ☑启用 推迟次数: [3]          │  │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

## 3. 核心组件设计

### 3.1 详情弹窗组件

```kotlin
@Composable
fun TodoDetailDialog(
    todoItem: TodoItem,
    onDismiss: () -> Unit,
    onEdit: () -> Unit,
    onComplete: () -> Unit,
    onDelete: () -> Unit
) {
    Dialog(onDismissRequest = onDismiss) {
        Card(modifier = Modifier.fillMaxWidth().padding(16.dp)) {
            Column {
                // Header with title and actions
                TodoDetailHeader(
                    onDismiss = onDismiss,
                    onEdit = onEdit,
                    onMore = { /* 更多操作 */ }
                )

                // Content section
                TodoDetailContent(todoItem = todoItem)

                // Action buttons
                TodoDetailActions(
                    onComplete = onComplete,
                    onSnooze = { /* 推迟逻辑 */ },
                    onEdit = onEdit,
                    onDelete = onDelete
                )
            }
        }
    }
}
```

### 3.2 编辑表单组件

```kotlin
@Composable
fun TodoEditScreen(
    uiState: TodoEditUiState,
    onAction: (TodoEditAction) -> Unit
) {
    Column(modifier = Modifier.fillMaxSize()) {
        // Top bar with save/cancel
        TodoEditTopBar(
            onSave = { onAction(TodoEditAction.Save) },
            onCancel = { onAction(TodoEditAction.Cancel) },
            hasUnsavedChanges = uiState.hasUnsavedChanges
        )

        // Scrollable form content
        LazyColumn(modifier = Modifier.weight(1f)) {
            item { TitleField(uiState.title) { onAction(TodoEditAction.UpdateTitle(it)) } }
            item { ContentField(uiState.content) { onAction(TodoEditAction.UpdateContent(it)) } }
            item { DateTimeSelector(uiState.triggerTime) { onAction(TodoEditAction.UpdateTime(it)) } }
            item { PrioritySelector(uiState.priority) { onAction(TodoEditAction.UpdatePriority(it)) } }
            item { CategorySelector(uiState.category) { onAction(TodoEditAction.UpdateCategory(it)) } }
            item { TagEditor(uiState.tags) { onAction(TodoEditAction.UpdateTags(it)) } }
            item { ReminderSettings(uiState.reminderEnabled) { onAction(TodoEditAction.ToggleReminder(it)) } }
        }
    }
}
```

## 4. 交互逻辑

### 4.1 详情查看流程

1. **打开详情**: 点击列表项 → 弹出详情弹窗
2. **信息展示**: 显示完整的待办信息，包括标题、内容、时间、优先级、分类、状态、标签
3. **快速操作**: 提供完成、推迟、编辑、删除等快速操作按钮
4. **关闭弹窗**: 点击×按钮或弹窗外区域关闭

### 4.2 编辑流程

1. **进入编辑**: 详情弹窗点击编辑 → 全屏编辑页面
2. **表单填写**: 修改各项信息，实时保存草稿
3. **验证检查**: 保存前验证必填字段和格式
4. **保存/取消**: 保存更改或取消编辑返回

### 4.3 状态操作

```kotlin
// 完成待办
fun completeTodo(todoId: String) {
    // 1. 更新状态为已完成
    // 2. 记录完成时间
    // 3. 取消相关通知
    // 4. 显示完成动画
    // 5. 更新列表显示
}

// 推迟待办
fun snoozeTodo(todoId: String, minutes: Int) {
    // 1. 检查推迟次数限制
    // 2. 计算新的提醒时间
    // 3. 更新状态为已推迟
    // 4. 重新设置通知
    // 5. 显示推迟确认信息
}

// 删除待办
fun deleteTodo(todoId: String) {
    // 1. 显示确认对话框
    // 2. 取消相关通知
    // 3. 从数据库删除
    // 4. 显示删除动画
    // 5. 更新列表显示
}
```

## 5. 表单组件

### 5.1 时间选择器

```kotlin
@Composable
fun DateTimeSelector(
    selectedTime: Long,
    onTimeSelected: (Long) -> Unit
) {
    Row(verticalAlignment = Alignment.CenterVertically) {
        // 日期选择
        OutlinedButton(onClick = { /* 显示日期选择器 */ }) {
            Text(formatDate(selectedTime))
        }

        Spacer(modifier = Modifier.width(8.dp))

        // 时间选择
        OutlinedButton(onClick = { /* 显示时间选择器 */ }) {
            Text(formatTime(selectedTime))
        }
    }
}
```

### 5.2 优先级选择器

```kotlin
@Composable
fun PrioritySelector(
    selectedPriority: TodoPriority,
    onPrioritySelected: (TodoPriority) -> Unit
) {
    Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {
        TodoPriority.values().forEach { priority ->
            FilterChip(
                selected = selectedPriority == priority,
                onClick = { onPrioritySelected(priority) },
                label = { Text(priority.displayName) },
                colors = FilterChipDefaults.filterChipColors(
                    selectedContainerColor = priority.color.copy(alpha = 0.2f)
                )
            )
        }
    }
}
```

### 5.3 标签编辑器

```kotlin
@Composable
fun TagEditor(
    tags: List<TodoTag>,
    onTagsChanged: (List<TodoTag>) -> Unit
) {
    Column {
        // 现有标签
        LazyRow(horizontalArrangement = Arrangement.spacedBy(4.dp)) {
            items(tags) { tag ->
                InputChip(
                    selected = true,
                    onClick = { /* 编辑标签 */ },
                    label = { Text(tag.name) },
                    trailingIcon = {
                        IconButton(onClick = { /* 删除标签 */ }) {
                            Icon(Icons.Default.Close, contentDescription = "删除")
                        }
                    }
                )
            }

            // 添加按钮
            item {
                InputChip(
                    selected = false,
                    onClick = { /* 添加新标签 */ },
                    label = { Text("+ 添加标签") }
                )
            }
        }
    }
}
```

## 6. 动画效果

### 6.1 弹窗动画

```kotlin
@Composable
fun AnimatedTodoDetailDialog(
    visible: Boolean,
    onDismiss: () -> Unit,
    content: @Composable () -> Unit
) {
    AnimatedVisibility(
        visible = visible,
        enter = slideInVertically(initialOffsetY = { it }) + fadeIn(),
        exit = slideOutVertically(targetOffsetY = { it }) + fadeOut()
    ) {
        content()
    }
}
```

### 6.2 状态变化动画

```kotlin
@Composable
fun AnimatedStatusChange(
    isCompleted: Boolean,
    content: @Composable () -> Unit
) {
    val alpha by animateFloatAsState(
        targetValue = if (isCompleted) 0.6f else 1f,
        animationSpec = tween(300)
    )

    val scale by animateFloatAsState(
        targetValue = if (isCompleted) 0.95f else 1f,
        animationSpec = spring(dampingRatio = Spring.DampingRatioMediumBouncy)
    )

    Box(
        modifier = Modifier
            .alpha(alpha)
            .scale(scale)
    ) {
        content()
    }
}
```

## 7. 响应式设计

### 7.1 屏幕适配

```kotlin
@Composable
fun ResponsiveTodoDetail(
    windowInfo: TodoWindowInfo,
    todoItem: TodoItem
) {
    when (windowInfo.screenWidthInfo) {
        TodoWindowInfo.WindowType.Compact -> {
            // 手机：全屏弹窗
            TodoDetailDialog(todoItem = todoItem)
        }
        TodoWindowInfo.WindowType.Medium -> {
            // 平板：侧边面板
            TodoDetailSidePanel(todoItem = todoItem)
        }
        TodoWindowInfo.WindowType.Expanded -> {
            // 大屏：分栏显示
            TodoDetailSplitView(todoItem = todoItem)
        }
    }
}
```

## 8. 状态管理

### 8.1 编辑状态

```kotlin
data class TodoEditUiState(
    val todoItem: TodoItem? = null,
    val title: String = "",
    val content: String = "",
    val triggerTime: Long = System.currentTimeMillis(),
    val priority: TodoPriority = TodoPriority.NORMAL,
    val category: TodoCategory = TodoCategory.GENERAL,
    val tags: List<TodoTag> = emptyList(),
    val reminderEnabled: Boolean = true,
    val isLoading: Boolean = false,
    val isSaving: Boolean = false,
    val hasUnsavedChanges: Boolean = false,
    val validationErrors: List<String> = emptyList()
)

sealed class TodoEditAction {
    object Load : TodoEditAction()
    data class UpdateTitle(val title: String) : TodoEditAction()
    data class UpdateContent(val content: String) : TodoEditAction()
    data class UpdateTime(val time: Long) : TodoEditAction()
    data class UpdatePriority(val priority: TodoPriority) : TodoEditAction()
    data class UpdateCategory(val category: TodoCategory) : TodoEditAction()
    data class UpdateTags(val tags: List<TodoTag>) : TodoEditAction()
    data class ToggleReminder(val enabled: Boolean) : TodoEditAction()
    object Save : TodoEditAction()
    object Cancel : TodoEditAction()
}
```

## 9. 验证和错误处理

### 9.1 表单验证

```kotlin
fun validateTodoForm(uiState: TodoEditUiState): List<String> {
    val errors = mutableListOf<String>()

    if (uiState.title.isBlank()) {
        errors.add("标题不能为空")
    }

    if (uiState.title.length > 100) {
        errors.add("标题长度不能超过100字符")
    }

    if (uiState.content.length > 500) {
        errors.add("内容长度不能超过500字符")
    }

    if (uiState.triggerTime <= System.currentTimeMillis()) {
        errors.add("触发时间不能早于当前时间")
    }

    return errors
}
```

### 9.2 错误提示

```kotlin
@Composable
fun ValidationErrorList(
    errors: List<String>,
    modifier: Modifier = Modifier
) {
    if (errors.isNotEmpty()) {
        Card(
            colors = CardDefaults.cardColors(
                containerColor = MaterialTheme.colorScheme.errorContainer
            ),
            modifier = modifier
        ) {
            Column(modifier = Modifier.padding(12.dp)) {
                Text(
                    text = "请修正以下问题：",
                    style = MaterialTheme.typography.labelMedium,
                    color = MaterialTheme.colorScheme.onErrorContainer
                )
                errors.forEach { error ->
                    Text(
                        text = "• $error",
                        style = MaterialTheme.typography.bodySmall,
                        color = MaterialTheme.colorScheme.onErrorContainer
                    )
                }
            }
        }
    }
}
```

## 10. 总结

待办详情和编辑UI设计要点：

1. **弹窗详情**: 快速查看和操作，不打断当前流程
2. **全屏编辑**: 提供完整的编辑体验，支持复杂表单
3. **实时验证**: 即时反馈，提升用户体验
4. **响应式布局**: 适配不同屏幕尺寸
5. **流畅动画**: 增强交互体验
6. **状态管理**: 清晰的状态流转和错误处理

这个设计确保了待办管理的完整性和易用性。