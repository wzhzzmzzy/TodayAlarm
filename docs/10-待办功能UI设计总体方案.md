# 定时提醒小助手 - 待办功能UI设计总体方案

## 1. 概述

本文档描述待办功能的UI设计总体方案，包括设计原则、页面架构、导航结构、主题系统和交互设计规范。

## 2. 设计原则

### 2.1 Material Design 3 规范
- 遵循 Material Design 3 设计语言
- 使用 Material You 动态颜色系统
- 支持浅色和深色主题
- 响应式设计适配不同屏幕尺寸

### 2.2 用户体验原则
- **简洁直观**: 界面简洁，操作直观易懂
- **高效操作**: 减少用户操作步骤，提高效率
- **一致性**: 保持界面元素和交互的一致性
- **可访问性**: 支持无障碍功能，包括语音读屏等

### 2.3 性能原则
- **流畅动画**: 使用高性能的动画效果
- **懒加载**: 大列表使用懒加载和虚拟化
- **状态管理**: 合理的状态管理避免不必要的重组

## 3. 页面架构

### 3.1 整体导航结构

```
主页 (MainActivity)
├── 周历视图 (WeeklyCalendarScreen)
│   ├── 日期选择器
│   ├── 待办指示器
│   └── 快速操作菜单
├── 待办列表 (TodoListScreen)
│   ├── 筛选和排序栏
│   ├── 搜索功能
│   ├── 待办项列表
│   └── 浮动操作按钮
├── 待办详情 (TodoDetailDialog)
│   ├── 基本信息编辑
│   ├── 优先级和分类
│   ├── 标签管理
│   └── 操作按钮区
└── 计划管理 (PlanScreen)
    ├── 计划列表
    ├── 添加计划
    └── 计划详情
```

### 3.2 页面层级关系

```
Level 1: 主页面 (底部导航)
├── 首页 (周历 + 今日待办)
├── 待办 (完整待办列表)
├── 计划 (计划管理)
└── 设置 (应用设置)

Level 2: 详情页面 (全屏)
├── 待办详情/编辑
├── 计划详情/编辑
└── 统计分析页面

Level 3: 弹窗和底部表单
├── 快速添加待办
├── 筛选选项
├── 日期时间选择器
└── 确认对话框
```

## 4. 主题系统设计

### 4.1 颜色系统

```kotlin
// ui/theme/TodoColors.kt
object TodoColors {

    // 优先级颜色
    val PriorityLow = Color(0xFF4CAF50)      // 绿色
    val PriorityNormal = Color(0xFF2196F3)   // 蓝色
    val PriorityHigh = Color(0xFFFF9800)     // 橙色
    val PriorityUrgent = Color(0xFFF44336)   // 红色

    // 状态颜色
    val StatusPending = Color(0xFF607D8B)    // 灰蓝色
    val StatusCompleted = Color(0xFF4CAF50)  // 绿色
    val StatusOverdue = Color(0xFFE91E63)    // 粉红色
    val StatusSnoozed = Color(0xFFFF9800)    // 橙色
    val StatusCancelled = Color(0xFF9E9E9E)  // 灰色

    // 分类颜色
    val CategoryWork = Color(0xFF3F51B5)     // 靛蓝色
    val CategoryPersonal = Color(0xFF9C27B0) // 紫色
    val CategoryHealth = Color(0xFF4CAF50)   // 绿色
    val CategoryStudy = Color(0xFF2196F3)    // 蓝色
    val CategoryShopping = Color(0xFFFF9800) // 橙色
    val CategoryGeneral = Color(0xFF607D8B)  // 灰蓝色

    // 功能颜色
    val Success = Color(0xFF4CAF50)
    val Warning = Color(0xFFFF9800)
    val Error = Color(0xFFF44336)
    val Info = Color(0xFF2196F3)

    // 背景色 (Light Theme)
    val BackgroundLight = Color(0xFFFFFBFE)
    val SurfaceLight = Color(0xFFFFFBFE)
    val SurfaceVariantLight = Color(0xFFE7E0EC)

    // 背景色 (Dark Theme)
    val BackgroundDark = Color(0xFF1C1B1F)
    val SurfaceDark = Color(0xFF1C1B1F)
    val SurfaceVariantDark = Color(0xFF49454F)
}
```

### 4.2 字体系统

```kotlin
// ui/theme/TodoTypography.kt
val TodoTypography = Typography(
    // 标题样式
    headlineLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Bold,
        fontSize = 32.sp,
        lineHeight = 40.sp,
        letterSpacing = 0.sp
    ),
    headlineMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Bold,
        fontSize = 28.sp,
        lineHeight = 36.sp,
        letterSpacing = 0.sp
    ),
    headlineSmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Bold,
        fontSize = 24.sp,
        lineHeight = 32.sp,
        letterSpacing = 0.sp
    ),

    // 正文样式
    bodyLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 16.sp,
        lineHeight = 24.sp,
        letterSpacing = 0.5.sp
    ),
    bodyMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 14.sp,
        lineHeight = 20.sp,
        letterSpacing = 0.25.sp
    ),
    bodySmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 12.sp,
        lineHeight = 16.sp,
        letterSpacing = 0.4.sp
    ),

    // 标签样式
    labelLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 14.sp,
        lineHeight = 20.sp,
        letterSpacing = 0.1.sp
    ),
    labelMedium = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 12.sp,
        lineHeight = 16.sp,
        letterSpacing = 0.5.sp
    ),
    labelSmall = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Medium,
        fontSize = 11.sp,
        lineHeight = 16.sp,
        letterSpacing = 0.5.sp
    )
)
```

### 4.3 尺寸系统

```kotlin
// ui/theme/TodoDimensions.kt
object TodoDimensions {

    // 间距
    val SpacingXSmall = 4.dp
    val SpacingSmall = 8.dp
    val SpacingMedium = 16.dp
    val SpacingLarge = 24.dp
    val SpacingXLarge = 32.dp
    val SpacingXXLarge = 48.dp

    // 圆角
    val CornerRadiusSmall = 4.dp
    val CornerRadiusMedium = 8.dp
    val CornerRadiusLarge = 12.dp
    val CornerRadiusXLarge = 16.dp

    // 组件尺寸
    val ButtonHeight = 48.dp
    val ButtonHeightSmall = 36.dp
    val InputFieldHeight = 56.dp
    val ListItemHeight = 72.dp
    val ListItemHeightCompact = 56.dp
    val AppBarHeight = 64.dp
    val BottomBarHeight = 80.dp
    val FabSize = 56.dp
    val FabSizeSmall = 40.dp

    // 卡片和容器
    val CardElevation = 4.dp
    val CardMaxWidth = 400.dp
    val DialogMaxWidth = 560.dp
    val BottomSheetPeekHeight = 128.dp

    // 图标尺寸
    val IconSizeSmall = 16.dp
    val IconSizeMedium = 24.dp
    val IconSizeLarge = 32.dp
    val IconSizeXLarge = 48.dp

    // 边框
    val BorderWidthThin = 1.dp
    val BorderWidthMedium = 2.dp
    val BorderWidthThick = 4.dp
}
```

## 5. 组件设计规范

### 5.1 待办项卡片设计

```kotlin
// ui/components/TodoItemCard.kt 设计规范

/**
 * 待办项卡片组件设计规范
 *
 * 布局结构:
 * ┌─────────────────────────────────────────┐
 * │ [●] 标题文本                    [优先级] │
 * │     内容描述文本 (可选)                  │
 * │     [分类标签] [时间] [状态指示器]       │
 * │     [标签1] [标签2] ...        [操作菜单] │
 * └─────────────────────────────────────────┘
 *
 * 交互状态:
 * - 默认状态: 正常显示
 * - 选中状态: 背景色变化，显示选中指示器
 * - 完成状态: 文字划线，降低透明度
 * - 过期状态: 红色边框，警告图标
 * - 推迟状态: 橙色边框，推迟图标
 */
```

### 5.2 筛选和排序栏设计

```kotlin
// ui/components/TodoFilterBar.kt 设计规范

/**
 * 筛选排序栏设计规范
 *
 * 布局结构:
 * ┌─────────────────────────────────────────┐
 * │ [搜索框                    ] [筛选] [排序] │
 * │ [状态筛选] [分类筛选] [优先级筛选] [清除]   │
 * └─────────────────────────────────────────┘
 *
 * 功能特性:
 * - 实时搜索
 * - 多条件筛选
 * - 动态排序
 * - 筛选条件保存
 */
```

### 5.3 操作按钮设计

```kotlin
// ui/components/TodoActionButtons.kt 设计规范

/**
 * 操作按钮设计规范
 *
 * 主要操作:
 * - 完成: 绿色圆形按钮，勾选图标
 * - 编辑: 蓝色图标按钮，编辑图标
 * - 删除: 红色图标按钮，删除图标
 * - 推迟: 橙色图标按钮，时钟图标
 *
 * 次要操作:
 * - 分享: 图标按钮，分享图标
 * - 复制: 图标按钮，复制图标
 * - 归档: 图标按钮，归档图标
 */
```

## 6. 动画和过渡效果

### 6.1 页面转场动画

```kotlin
// ui/animation/TodoAnimations.kt

object TodoAnimations {

    // 页面转场动画
    val SlideInFromRight = slideInHorizontally(
        initialOffsetX = { it },
        animationSpec = tween(300, easing = FastOutSlowInEasing)
    )

    val SlideOutToLeft = slideOutHorizontally(
        targetOffsetX = { -it },
        animationSpec = tween(300, easing = FastOutSlowInEasing)
    )

    // 列表项动画
    val FadeInScale = fadeIn(tween(200)) + scaleIn(
        initialScale = 0.8f,
        animationSpec = tween(200, easing = FastOutSlowInEasing)
    )

    val FadeOutScale = fadeOut(tween(150)) + scaleOut(
        targetScale = 0.8f,
        animationSpec = tween(150, easing = FastOutSlowInEasing)
    )

    // 状态变化动画
    val StatusChangeAnimation = tween<Color>(
        durationMillis = 300,
        easing = FastOutSlowInEasing
    )

    // 完成动画
    val CompleteAnimation = keyframes<Float> {
        durationMillis = 600
        0f at 0 with FastOutSlowInEasing
        1.2f at 200 with FastOutSlowInEasing
        1f at 400 with FastOutSlowInEasing
    }
}
```

### 6.2 微交互动画

```kotlin
// 按钮点击反馈
val ButtonPressAnimation = animateFloatAsState(
    targetValue = if (isPressed) 0.95f else 1f,
    animationSpec = spring(
        dampingRatio = Spring.DampingRatioMediumBouncy,
        stiffness = Spring.StiffnessLow
    )
)

// 卡片悬浮效果
val CardElevationAnimation = animateFloatAsState(
    targetValue = if (isHovered) 8f else 4f,
    animationSpec = tween(200, easing = FastOutSlowInEasing)
)

// 进度指示器动画
val ProgressAnimation = animateFloatAsState(
    targetValue = progress,
    animationSpec = tween(500, easing = FastOutSlowInEasing)
)
```

## 7. 响应式设计

### 7.1 屏幕尺寸适配

```kotlin
// ui/responsive/TodoResponsive.kt

@Composable
fun rememberTodoWindowInfo(): TodoWindowInfo {
    val configuration = LocalConfiguration.current
    return remember(configuration) {
        TodoWindowInfo(
            screenWidthInfo = when {
                configuration.screenWidthDp < 600 -> TodoWindowInfo.WindowType.Compact
                configuration.screenWidthDp < 840 -> TodoWindowInfo.WindowType.Medium
                else -> TodoWindowInfo.WindowType.Expanded
            },
            screenHeightInfo = when {
                configuration.screenHeightDp < 480 -> TodoWindowInfo.WindowType.Compact
                configuration.screenHeightDp < 900 -> TodoWindowInfo.WindowType.Medium
                else -> TodoWindowInfo.WindowType.Expanded
            },
            screenWidth = configuration.screenWidthDp.dp,
            screenHeight = configuration.screenHeightDp.dp
        )
    }
}

data class TodoWindowInfo(
    val screenWidthInfo: WindowType,
    val screenHeightInfo: WindowType,
    val screenWidth: Dp,
    val screenHeight: Dp
) {
    enum class WindowType { Compact, Medium, Expanded }
}
```

### 7.2 自适应布局

```kotlin
// 根据屏幕尺寸调整布局
@Composable
fun TodoAdaptiveLayout(
    windowInfo: TodoWindowInfo,
    content: @Composable () -> Unit
) {
    when (windowInfo.screenWidthInfo) {
        TodoWindowInfo.WindowType.Compact -> {
            // 单列布局，底部导航
            Column {
                content()
            }
        }
        TodoWindowInfo.WindowType.Medium -> {
            // 双列布局，侧边导航
            Row {
                NavigationRail(modifier = Modifier.width(80.dp)) {
                    // 导航项
                }
                content()
            }
        }
        TodoWindowInfo.WindowType.Expanded -> {
            // 三列布局，抽屉导航
            Row {
                NavigationDrawer(modifier = Modifier.width(240.dp)) {
                    // 导航内容
                }
                content()
            }
        }
    }
}
```

## 8. 可访问性设计

### 8.1 语义化标签

```kotlin
// 为UI元素添加语义化描述
@Composable
fun AccessibleTodoItem(
    todoItem: TodoItem,
    onComplete: () -> Unit
) {
    Card(
        modifier = Modifier.semantics {
            contentDescription = "待办事项: ${todoItem.title}, " +
                "状态: ${if (todoItem.isCompleted()) "已完成" else "待完成"}, " +
                "优先级: ${todoItem.priority}, " +
                "时间: ${formatTime(todoItem.triggerTime)}"

            // 自定义操作
            customActions = listOf(
                CustomAccessibilityAction(
                    label = if (todoItem.isCompleted()) "取消完成" else "标记完成",
                    action = { onComplete(); true }
                )
            )
        }
    ) {
        // 卡片内容
    }
}
```

### 8.2 颜色对比度

```kotlin
// 确保颜色对比度符合WCAG标准
object AccessibleColors {
    // 最小对比度 4.5:1 (AA级)
    val TextOnBackground = Color(0xFF1C1B1F)  // 对比度: 15.8:1
    val TextOnSurface = Color(0xFF1C1B1F)     // 对比度: 15.8:1

    // 最小对比度 3:1 (大文本AA级)
    val SecondaryTextOnBackground = Color(0xFF49454F)  // 对比度: 7.2:1

    // 状态颜色对比度检查
    val ErrorTextOnSurface = Color(0xFFB3261E)  // 对比度: 5.1:1
    val SuccessTextOnSurface = Color(0xFF1B5E20) // 对比度: 8.2:1
}
```

## 9. 性能优化

### 9.1 Compose 优化

```kotlin
// 使用稳定的数据类
@Stable
data class TodoItemUiState(
    val id: String,
    val title: String,
    val isCompleted: Boolean,
    val priority: TodoPriority,
    val formattedTime: String
)

// 避免不必要的重组
@Composable
fun OptimizedTodoList(
    todoItems: List<TodoItemUiState>,
    onItemClick: (String) -> Unit
) {
    LazyColumn {
        items(
            items = todoItems,
            key = { it.id }  // 使用稳定的key
        ) { todoItem ->
            TodoItemCard(
                todoItem = todoItem,
                onItemClick = remember { { onItemClick(todoItem.id) } }
            )
        }
    }
}
```

### 9.2 内存优化

```kotlin
// 图片加载优化
@Composable
fun OptimizedImage(
    imageUrl: String,
    contentDescription: String?
) {
    AsyncImage(
        model = ImageRequest.Builder(LocalContext.current)
            .data(imageUrl)
            .memoryCacheKey(imageUrl)
            .diskCacheKey(imageUrl)
            .crossfade(true)
            .size(Size.ORIGINAL)
            .build(),
        contentDescription = contentDescription,
        modifier = Modifier.size(48.dp)
    )
}
```

## 10. 测试策略

### 10.1 UI测试

```kotlin
// Compose UI测试示例
@Test
fun todoListDisplaysItems() {
    composeTestRule.setContent {
        TodoListScreen(
            uiState = TodoListUiState(
                todoItems = listOf(
                    TodoItem(title = "测试待办", content = "测试内容")
                )
            ),
            onAction = {}
        )
    }

    composeTestRule
        .onNodeWithText("测试待办")
        .assertIsDisplayed()
}

@Test
fun todoItemCanBeCompleted() {
    var completed = false

    composeTestRule.setContent {
        TodoItemCard(
            todoItem = TodoItem(title = "测试待办"),
            onComplete = { completed = true }
        )
    }

    composeTestRule
        .onNodeWithContentDescription("完成待办")
        .performClick()

    assert(completed)
}
```

### 10.2 可访问性测试

```kotlin
@Test
fun todoItemHasProperSemantics() {
    composeTestRule.setContent {
        TodoItemCard(
            todoItem = TodoItem(
                title = "重要会议",
                priority = TodoPriority.HIGH
            )
        )
    }

    composeTestRule
        .onNodeWithContentDescription("待办事项: 重要会议, 优先级: HIGH")
        .assertIsDisplayed()
}
```

## 11. 下一步

UI设计总体方案完成后，接下来将创建具体的实现文档：

1. **11-待办列表页面UI设计.md** - 待办列表页面的详细UI实现
2. **12-待办详情和编辑UI设计.md** - 待办详情和编辑页面的UI实现
3. **13-UI组件库设计.md** - 通用UI组件的设计和实现
4. **14-待办功能系统集成.md** - 系统集成和通知处理

这个总体方案为待办功能的UI设计提供了完整的设计规范和技术指导。