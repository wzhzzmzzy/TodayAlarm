# 定时提醒小助手 - UI层开发技术方案

## 1. UI层架构设计

### 1.1 整体架构
UI层采用现代化的 Jetpack Compose 开发，遵循 Material 3 设计规范，实现响应式和声明式UI。

```
UI Layer Architecture
┌─────────────────────────────────────────────┐
│                   Screens                   │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│  │  HomeScreen │ │ PlanScreen  │ │ Others  │ │
│  └─────────────┘ └─────────────┘ └─────────┘ │
├─────────────────────────────────────────────┤
│                 Components                  │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│  │   Calendar  │ │  PlanCard   │ │  Dialog │ │
│  └─────────────┘ └─────────────┘ └─────────┘ │
├─────────────────────────────────────────────┤
│                 Navigation                  │
│         ┌─────────────────────────┐         │
│         │    NavController        │         │
│         └─────────────────────────┘         │
├─────────────────────────────────────────────┤
│                   Theme                     │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│  │   Colors    │ │ Typography  │ │ Shapes  │ │
│  └─────────────┘ └─────────────┘ └─────────┘ │
└─────────────────────────────────────────────┘
```

### 1.2 技术栈
- **Jetpack Compose**: 声明式UI框架
- **Material 3**: 设计系统和组件库
- **Compose Navigation**: 页面导航管理
- **Compose Animation**: 动画效果
- **Accompanist**: Compose 扩展库

## 2. 页面结构设计

### 2.1 主页面 (HomeScreen)

#### 功能布局
```kotlin
@Composable
fun HomeScreen() {
    Column(
        modifier = Modifier.fillMaxSize()
    ) {
        // 顶部标题栏
        TopAppBar()

        // 周历视图
        WeekCalendarView()

        // 今日待办事项
        TodayTodoSection()

        Spacer(modifier = Modifier.weight(1f))

        // 底部操作按钮
        BottomActionButtons()
    }
}
```

#### 核心组件
1. **WeekCalendarView**: 显示本周日历，高亮当前日期
2. **TodayTodoSection**: 显示今日待办事项列表
3. **BottomActionButtons**: 计划列表和添加计划按钮

### 2.2 添加计划页面 (AddPlanScreen)

#### 表单设计
```kotlin
@Composable
fun AddPlanScreen() {
    LazyColumn(
        modifier = Modifier
            .fillMaxSize()
            .padding(16.dp)
    ) {
        item { PlanTitleInput() }
        item { PlanContentInput() }
        item { DateTimePicker() }
        item { RepeatSettings() }
        item { SaveButton() }
    }
}
```

#### 关键组件
1. **DateTimePicker**: 日期时间选择器
2. **RepeatSettings**: 重复设置选项
3. **PlanTitleInput**: 计划标题输入
4. **PlanContentInput**: 计划内容输入

### 2.3 计划列表页面 (PlanListScreen)

#### 列表设计
```kotlin
@Composable
fun PlanListScreen() {
    LazyColumn {
        items(plans) { plan ->
            PlanCard(
                plan = plan,
                onEdit = { /* 编辑计划 */ },
                onDelete = { /* 删除计划 */ },
                onToggle = { /* 开关计划 */ }
            )
        }
    }
}
```

## 3. 核心组件设计

### 3.1 周历组件 (WeekCalendarView)

#### 实现方案
```kotlin
@Composable
fun WeekCalendarView(
    currentWeek: List<LocalDate>,
    selectedDate: LocalDate,
    todoItems: Map<LocalDate, List<TodoItem>>,
    onDateSelected: (LocalDate) -> Unit
) {
    LazyColumn {
        items(currentWeek) { date ->
            DayRow(
                date = date,
                isSelected = date == selectedDate,
                todoItems = todoItems[date] ?: emptyList(),
                onClick = { onDateSelected(date) }
            )
        }
    }
}
```

#### 设计特点
- 每行显示一天的信息
- 高亮当前日期
- 显示当日的待办事项数量
- 支持点击切换日期

### 3.2 计划卡片 (PlanCard)

#### 卡片布局
```kotlin
@Composable
fun PlanCard(
    plan: Plan,
    onEdit: () -> Unit,
    onDelete: () -> Unit,
    onToggle: (Boolean) -> Unit
) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .padding(horizontal = 16.dp, vertical = 4.dp),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Column(
            modifier = Modifier.padding(16.dp)
        ) {
            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween,
                verticalAlignment = Alignment.CenterVertically
            ) {
                Text(
                    text = plan.title,
                    style = MaterialTheme.typography.titleMedium
                )
                Switch(
                    checked = plan.isActive,
                    onCheckedChange = onToggle
                )
            }

            Text(
                text = plan.content,
                style = MaterialTheme.typography.bodyMedium,
                maxLines = 2,
                overflow = TextOverflow.Ellipsis
            )

            Spacer(modifier = Modifier.height(8.dp))

            Row(
                modifier = Modifier.fillMaxWidth(),
                horizontalArrangement = Arrangement.SpaceBetween
            ) {
                Text(
                    text = formatDateTime(plan.triggerTime),
                    style = MaterialTheme.typography.bodySmall,
                    color = MaterialTheme.colorScheme.onSurfaceVariant
                )

                Row {
                    IconButton(onClick = onEdit) {
                        Icon(Icons.Default.Edit, contentDescription = "编辑")
                    }
                    IconButton(onClick = onDelete) {
                        Icon(Icons.Default.Delete, contentDescription = "删除")
                    }
                }
            }
        }
    }
}
```

### 3.3 日期时间选择器

#### 实现方案
```kotlin
@Composable
fun DateTimePicker(
    selectedDateTime: LocalDateTime,
    onDateTimeSelected: (LocalDateTime) -> Unit
) {
    var showDatePicker by remember { mutableStateOf(false) }
    var showTimePicker by remember { mutableStateOf(false) }

    Column {
        // 日期选择按钮
        OutlinedButton(
            onClick = { showDatePicker = true }
        ) {
            Icon(Icons.Default.DateRange, contentDescription = null)
            Spacer(modifier = Modifier.width(8.dp))
            Text(formatDate(selectedDateTime.toLocalDate()))
        }

        Spacer(modifier = Modifier.height(8.dp))

        // 时间选择按钮
        OutlinedButton(
            onClick = { showTimePicker = true }
        ) {
            Icon(Icons.Default.AccessTime, contentDescription = null)
            Spacer(modifier = Modifier.width(8.dp))
            Text(formatTime(selectedDateTime.toLocalTime()))
        }
    }

    // 日期选择器对话框
    if (showDatePicker) {
        DatePickerDialog(
            onDateSelected = { date ->
                onDateTimeSelected(
                    selectedDateTime.with(date)
                )
                showDatePicker = false
            },
            onDismiss = { showDatePicker = false }
        )
    }

    // 时间选择器对话框
    if (showTimePicker) {
        TimePickerDialog(
            onTimeSelected = { time ->
                onDateTimeSelected(
                    selectedDateTime.with(time)
                )
                showTimePicker = false
            },
            onDismiss = { showTimePicker = false }
        )
    }
}
```

## 4. 导航管理

### 4.1 导航结构
```kotlin
sealed class Screen(val route: String) {
    object Home : Screen("home")
    object AddPlan : Screen("add_plan")
    object PlanList : Screen("plan_list")
    object EditPlan : Screen("edit_plan/{planId}") {
        fun createRoute(planId: String) = "edit_plan/$planId"
    }
}
```

### 4.2 导航配置
```kotlin
@Composable
fun TodayAlarmNavigation(
    navController: NavHostController
) {
    NavHost(
        navController = navController,
        startDestination = Screen.Home.route
    ) {
        composable(Screen.Home.route) {
            HomeScreen(
                onNavigateToAddPlan = {
                    navController.navigate(Screen.AddPlan.route)
                },
                onNavigateToPlanList = {
                    navController.navigate(Screen.PlanList.route)
                }
            )
        }

        composable(Screen.AddPlan.route) {
            AddPlanScreen(
                onNavigateBack = {
                    navController.popBackStack()
                }
            )
        }

        composable(Screen.PlanList.route) {
            PlanListScreen(
                onNavigateToEdit = { planId ->
                    navController.navigate(Screen.EditPlan.createRoute(planId))
                },
                onNavigateBack = {
                    navController.popBackStack()
                }
            )
        }

        composable(
            route = Screen.EditPlan.route,
            arguments = listOf(navArgument("planId") { type = NavType.StringType })
        ) { backStackEntry ->
            val planId = backStackEntry.arguments?.getString("planId") ?: ""
            EditPlanScreen(
                planId = planId,
                onNavigateBack = {
                    navController.popBackStack()
                }
            )
        }
    }
}
```

## 5. 主题和样式

### 5.1 Material 3 主题配置
```kotlin
@Composable
fun TodayAlarmTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        darkTheme -> darkColorScheme(
            primary = Purple80,
            secondary = PurpleGrey80,
            tertiary = Pink80
        )
        else -> lightColorScheme(
            primary = Purple40,
            secondary = PurpleGrey40,
            tertiary = Pink40
        )
    }

    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography,
        shapes = Shapes,
        content = content
    )
}
```

### 5.2 自定义颜色
```kotlin
val Purple80 = Color(0xFFD0BCFF)
val PurpleGrey80 = Color(0xFFCCC2DC)
val Pink80 = Color(0xFFEFB8C8)

val Purple40 = Color(0xFF6650a4)
val PurpleGrey40 = Color(0xFF625b71)
val Pink40 = Color(0xFF7D5260)

// 状态颜色
val SuccessColor = Color(0xFF4CAF50)
val WarningColor = Color(0xFFFF9800)
val ErrorColor = Color(0xFFF44336)
```

### 5.3 字体样式
```kotlin
val Typography = Typography(
    displayLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 57.sp,
        lineHeight = 64.sp,
        letterSpacing = (-0.25).sp,
    ),
    titleLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 22.sp,
        lineHeight = 28.sp,
        letterSpacing = 0.sp,
    ),
    bodyLarge = TextStyle(
        fontFamily = FontFamily.Default,
        fontWeight = FontWeight.Normal,
        fontSize = 16.sp,
        lineHeight = 24.sp,
        letterSpacing = 0.5.sp,
    )
)
```

## 6. 状态管理

### 6.1 UI状态定义
```kotlin
data class HomeUiState(
    val currentWeek: List<LocalDate> = emptyList(),
    val selectedDate: LocalDate = LocalDate.now(),
    val todayTodos: List<TodoItem> = emptyList(),
    val weekTodos: Map<LocalDate, List<TodoItem>> = emptyMap(),
    val isLoading: Boolean = false,
    val error: String? = null
)

data class AddPlanUiState(
    val title: String = "",
    val content: String = "",
    val triggerDateTime: LocalDateTime = LocalDateTime.now().plusHours(1),
    val isRepeating: Boolean = false,
    val repeatType: RepeatType = RepeatType.NONE,
    val isLoading: Boolean = false,
    val error: String? = null
)
```

### 6.2 ViewModel 实现
```kotlin
@HiltViewModel
class HomeViewModel @Inject constructor(
    private val planRepository: PlanRepository,
    private val todoRepository: TodoRepository
) : ViewModel() {

    private val _uiState = MutableStateFlow(HomeUiState())
    val uiState: StateFlow<HomeUiState> = _uiState.asStateFlow()

    init {
        loadData()
    }

    private fun loadData() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }

            try {
                val currentWeek = getCurrentWeek()
                val todayTodos = todoRepository.getTodayTodos()
                val weekTodos = todoRepository.getWeekTodos(currentWeek)

                _uiState.update {
                    it.copy(
                        currentWeek = currentWeek,
                        todayTodos = todayTodos,
                        weekTodos = weekTodos,
                        isLoading = false
                    )
                }
            } catch (e: Exception) {
                _uiState.update {
                    it.copy(
                        isLoading = false,
                        error = e.message
                    )
                }
            }
        }
    }

    fun selectDate(date: LocalDate) {
        _uiState.update { it.copy(selectedDate = date) }
    }

    private fun getCurrentWeek(): List<LocalDate> {
        val today = LocalDate.now()
        val startOfWeek = today.with(DayOfWeek.MONDAY)
        return (0..6).map { startOfWeek.plusDays(it.toLong()) }
    }
}
```

## 7. 动画效果

### 7.1 页面转场动画
```kotlin
@Composable
fun AnimatedNavHost() {
    AnimatedNavHost(
        navController = navController,
        startDestination = Screen.Home.route,
        enterTransition = {
            slideInHorizontally(
                initialOffsetX = { 1000 },
                animationSpec = tween(300)
            )
        },
        exitTransition = {
            slideOutHorizontally(
                targetOffsetX = { -1000 },
                animationSpec = tween(300)
            )
        }
    ) {
        // 页面定义...
    }
}
```

### 7.2 列表项动画
```kotlin
@Composable
fun AnimatedPlanCard(
    plan: Plan,
    modifier: Modifier = Modifier
) {
    var visible by remember { mutableStateOf(false) }

    LaunchedEffect(plan) {
        visible = true
    }

    AnimatedVisibility(
        visible = visible,
        enter = fadeIn() + slideInVertically(),
        exit = fadeOut() + slideOutVertically(),
        modifier = modifier
    ) {
        PlanCard(plan = plan)
    }
}
```

## 8. 响应式设计

### 8.1 屏幕适配
```kotlin
@Composable
fun ResponsiveLayout(
    content: @Composable (WindowSizeClass) -> Unit
) {
    val windowSizeClass = calculateWindowSizeClass()

    content(windowSizeClass)
}

@Composable
fun AdaptiveHomeScreen() {
    ResponsiveLayout { windowSize ->
        when (windowSize.widthSizeClass) {
            WindowWidthSizeClass.Compact -> {
                // 手机竖屏布局
                CompactHomeLayout()
            }
            WindowWidthSizeClass.Medium -> {
                // 平板或手机横屏布局
                MediumHomeLayout()
            }
            WindowWidthSizeClass.Expanded -> {
                // 大屏设备布局
                ExpandedHomeLayout()
            }
        }
    }
}
```

### 8.2 密度适配
```kotlin
@Composable
fun DensityAwarePadding(): Dp {
    val density = LocalDensity.current.density
    return when {
        density <= 1.0f -> 12.dp
        density <= 2.0f -> 16.dp
        else -> 20.dp
    }
}
```

## 9. 可访问性

### 9.1 语义化标签
```kotlin
@Composable
fun AccessiblePlanCard(plan: Plan) {
    Card(
        modifier = Modifier
            .semantics {
                contentDescription = "计划: ${plan.title}, 时间: ${formatDateTime(plan.triggerTime)}"
                role = Role.Button
            }
    ) {
        // 卡片内容...
    }
}
```

### 9.2 焦点管理
```kotlin
@Composable
fun AccessibleForm() {
    val focusRequester = remember { FocusRequester() }

    Column {
        OutlinedTextField(
            value = title,
            onValueChange = { title = it },
            label = { Text("计划标题") },
            modifier = Modifier
                .focusRequester(focusRequester)
                .semantics {
                    contentDescription = "请输入计划标题"
                }
        )

        LaunchedEffect(Unit) {
            focusRequester.requestFocus()
        }
    }
}
```

## 10. 性能优化

### 10.1 重组优化
```kotlin
@Composable
fun OptimizedPlanList(
    plans: List<Plan>,
    onPlanClick: (String) -> Unit
) {
    LazyColumn {
        items(
            items = plans,
            key = { it.id }
        ) { plan ->
            PlanCard(
                plan = plan,
                onClick = remember(plan.id) {
                    { onPlanClick(plan.id) }
                }
            )
        }
    }
}
```

### 10.2 内存优化
```kotlin
@Composable
fun MemoryEfficientCalendar() {
    val calendar = remember {
        Calendar.getInstance()
    }

    DisposableEffect(Unit) {
        onDispose {
            // 清理资源
        }
    }
}
```

## 11. 测试策略

### 11.1 Compose 测试
```kotlin
@Test
fun homeScreen_displaysCorrectContent() {
    composeTestRule.setContent {
        TodayAlarmTheme {
            HomeScreen(
                uiState = HomeUiState(
                    todayTodos = listOf(
                        TodoItem(
                            id = "1",
                            title = "测试待办",
                            content = "测试内容"
                        )
                    )
                )
            )
        }
    }

    composeTestRule
        .onNodeWithText("测试待办")
        .assertIsDisplayed()
}
```

### 11.2 交互测试
```kotlin
@Test
fun addPlan_savesCorrectly() {
    composeTestRule.setContent {
        AddPlanScreen()
    }

    composeTestRule
        .onNodeWithText("计划标题")
        .performTextInput("新计划")

    composeTestRule
        .onNodeWithText("保存")
        .performClick()

    // 验证保存结果
}
```

## 12. 国际化支持

### 12.1 字符串资源
```xml
<!-- strings.xml -->
<resources>
    <string name="app_name">定时提醒小助手</string>
    <string name="home_title">今日</string>
    <string name="add_plan">添加计划</string>
    <string name="plan_list">计划列表</string>
    <string name="plan_title">计划标题</string>
    <string name="plan_content">计划内容</string>
    <string name="trigger_time">提醒时间</string>
    <string name="repeat_settings">重复设置</string>
</resources>
```

### 12.2 多语言支持
```kotlin
@Composable
fun LocalizedText(
    @StringRes textRes: Int,
    modifier: Modifier = Modifier
) {
    Text(
        text = stringResource(textRes),
        modifier = modifier
    )
}
```

这个UI层开发技术方案涵盖了从架构设计到具体实现的各个方面，为定时提醒小助手的UI开发提供了完整的技术指导。