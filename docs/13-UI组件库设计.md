# 定时提醒小助手 - UI组件库设计

## 1. 概述

本文档描述待办功能的通用UI组件库设计，包括基础组件、复合组件和主题系统。

## 2. 基础组件

### 2.1 标签组件 (Chips)

```kotlin
// 优先级标签
@Composable
fun TodoPriorityChip(
    priority: TodoPriority,
    size: TodoChipSize = TodoChipSize.Medium,
    onClick: (() -> Unit)? = null
) {
    val colors = when (priority) {
        TodoPriority.LOW -> TodoColors.PriorityLow
        TodoPriority.NORMAL -> TodoColors.PriorityNormal
        TodoPriority.HIGH -> TodoColors.PriorityHigh
        TodoPriority.URGENT -> TodoColors.PriorityUrgent
    }

    AssistChip(
        onClick = onClick ?: {},
        label = { Text(priority.displayName) },
        colors = AssistChipDefaults.assistChipColors(
            containerColor = colors.copy(alpha = 0.2f),
            labelColor = colors
        ),
        modifier = Modifier.height(size.height)
    )
}

// 分类标签
@Composable
fun TodoCategoryChip(
    category: TodoCategory,
    size: TodoChipSize = TodoChipSize.Medium
) {
    // 类似实现，使用分类颜色
}

// 状态标签
@Composable
fun TodoStatusChip(
    status: TodoStatus,
    size: TodoChipSize = TodoChipSize.Medium
) {
    // 类似实现，使用状态颜色
}

enum class TodoChipSize(val height: Dp) {
    Small(24.dp),
    Medium(32.dp),
    Large(40.dp)
}
```

### 2.2 按钮组件

```kotlin
// 完成按钮
@Composable
fun TodoCompleteButton(
    isCompleted: Boolean,
    onClick: () -> Unit,
    modifier: Modifier = Modifier
) {
    IconButton(
        onClick = onClick,
        modifier = modifier
    ) {
        Icon(
            imageVector = if (isCompleted) Icons.Default.CheckCircle else Icons.Default.RadioButtonUnchecked,
            contentDescription = if (isCompleted) "取消完成" else "标记完成",
            tint = if (isCompleted) TodoColors.Success else MaterialTheme.colorScheme.onSurface
        )
    }
}

// 推迟按钮
@Composable
fun TodoSnoozeButton(
    onSnooze: (Int) -> Unit,
    modifier: Modifier = Modifier
) {
    var showMenu by remember { mutableStateOf(false) }

    Box(modifier = modifier) {
        IconButton(onClick = { showMenu = true }) {
            Icon(
                imageVector = Icons.Default.Schedule,
                contentDescription = "推迟",
                tint = TodoColors.Warning
            )
        }

        DropdownMenu(
            expanded = showMenu,
            onDismissRequest = { showMenu = false }
        ) {
            listOf(15, 30, 60, 120).forEach { minutes ->
                DropdownMenuItem(
                    text = { Text("推迟 $minutes 分钟") },
                    onClick = {
                        onSnooze(minutes)
                        showMenu = false
                    }
                )
            }
        }
    }
}
```

### 2.3 指示器组件

```kotlin
// 状态指示器
@Composable
fun TodoStatusIndicator(
    status: TodoStatus,
    size: TodoIndicatorSize = TodoIndicatorSize.Medium
) {
    val (color, icon) = when (status) {
        TodoStatus.PENDING -> TodoColors.StatusPending to Icons.Default.Schedule
        TodoStatus.COMPLETED -> TodoColors.StatusCompleted to Icons.Default.CheckCircle
        TodoStatus.OVERDUE -> TodoColors.StatusOverdue to Icons.Default.Warning
        TodoStatus.SNOOZED -> TodoColors.StatusSnoozed to Icons.Default.Snooze
        TodoStatus.CANCELLED -> TodoColors.StatusCancelled to Icons.Default.Cancel
    }

    Icon(
        imageVector = icon,
        contentDescription = status.displayName,
        tint = color,
        modifier = Modifier.size(size.iconSize)
    )
}

// 优先级指示器
@Composable
fun TodoPriorityIndicator(
    priority: TodoPriority,
    size: TodoIndicatorSize = TodoIndicatorSize.Medium
) {
    val dotCount = when (priority) {
        TodoPriority.LOW -> 1
        TodoPriority.NORMAL -> 2
        TodoPriority.HIGH -> 3
        TodoPriority.URGENT -> 4
    }

    Row(horizontalArrangement = Arrangement.spacedBy(2.dp)) {
        repeat(dotCount) {
            Box(
                modifier = Modifier
                    .size(size.dotSize)
                    .background(
                        color = priority.color,
                        shape = CircleShape
                    )
            )
        }
    }
}

enum class TodoIndicatorSize(val iconSize: Dp, val dotSize: Dp) {
    Small(12.dp, 3.dp),
    Medium(16.dp, 4.dp),
    Large(20.dp, 5.dp)
}
```

## 3. 复合组件

### 3.1 时间显示组件

```kotlin
@Composable
fun TodoTimeDisplay(
    timestamp: Long,
    isOverdue: Boolean = false,
    format24Hour: Boolean = true,
    showRelativeTime: Boolean = true
) {
    val timeText = if (showRelativeTime) {
        getRelativeTimeString(timestamp)
    } else {
        formatDateTime(timestamp, format24Hour)
    }

    Text(
        text = timeText,
        style = MaterialTheme.typography.bodySmall,
        color = if (isOverdue) {
            TodoColors.Error
        } else {
            MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)
        }
    )
}

private fun getRelativeTimeString(timestamp: Long): String {
    val now = System.currentTimeMillis()
    val diff = timestamp - now

    return when {
        diff < 0 -> "已过期"
        diff < 60 * 60 * 1000 -> "1小时内"
        diff < 24 * 60 * 60 * 1000 -> "今天"
        diff < 7 * 24 * 60 * 60 * 1000 -> "本周"
        else -> SimpleDateFormat("MM-dd", Locale.getDefault()).format(Date(timestamp))
    }
}
```

### 3.2 筛选器组件

```kotlin
@Composable
fun TodoFilterSelector(
    filters: List<TodoFilter>,
    selectedFilter: TodoFilter,
    onFilterSelected: (TodoFilter) -> Unit,
    modifier: Modifier = Modifier
) {
    LazyRow(
        horizontalArrangement = Arrangement.spacedBy(8.dp),
        contentPadding = PaddingValues(horizontal = 16.dp),
        modifier = modifier
    ) {
        items(filters) { filter ->
            FilterChip(
                selected = filter == selectedFilter,
                onClick = { onFilterSelected(filter) },
                label = { Text(filter.displayName) },
                leadingIcon = if (filter == selectedFilter) {
                    { Icon(Icons.Default.Check, contentDescription = null) }
                } else null
            )
        }
    }
}
```

### 3.3 统计卡片组件

```kotlin
@Composable
fun TodoStatisticsCard(
    statistics: TodoStatistics,
    modifier: Modifier = Modifier
) {
    Card(modifier = modifier) {
        Column(modifier = Modifier.padding(16.dp)) {
            Text(
                text = "待办统计",
                style = MaterialTheme.typography.titleMedium
            )

            Spacer(modifier = Modifier.height(12.dp))

            // 完成率进度条
            LinearProgressIndicator(
                progress = statistics.completionRate,
                modifier = Modifier.fillMaxWidth()
            )

            Spacer(modifier = Modifier.height(8.dp))

            // 统计数字
            Row(
                horizontalArrangement = Arrangement.SpaceEvenly,
                modifier = Modifier.fillMaxWidth()
            ) {
                StatisticItem("总计", statistics.totalCount)
                StatisticItem("已完成", statistics.completedCount)
                StatisticItem("待完成", statistics.pendingCount)
                StatisticItem("已过期", statistics.overdueCount)
            }
        }
    }
}

@Composable
private fun StatisticItem(label: String, value: Int) {
    Column(horizontalAlignment = Alignment.CenterHorizontally) {
        Text(
            text = value.toString(),
            style = MaterialTheme.typography.headlineSmall,
            color = MaterialTheme.colorScheme.primary
        )
        Text(
            text = label,
            style = MaterialTheme.typography.bodySmall,
            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)
        )
    }
}
```

## 4. 表单组件

### 4.1 输入字段组件

```kotlin
@Composable
fun TodoTextField(
    value: String,
    onValueChange: (String) -> Unit,
    label: String,
    placeholder: String = "",
    isError: Boolean = false,
    errorMessage: String? = null,
    maxLines: Int = 1,
    modifier: Modifier = Modifier
) {
    Column(modifier = modifier) {
        OutlinedTextField(
            value = value,
            onValueChange = onValueChange,
            label = { Text(label) },
            placeholder = { Text(placeholder) },
            isError = isError,
            maxLines = maxLines,
            modifier = Modifier.fillMaxWidth()
        )

        if (isError && errorMessage != null) {
            Text(
                text = errorMessage,
                color = MaterialTheme.colorScheme.error,
                style = MaterialTheme.typography.bodySmall,
                modifier = Modifier.padding(start = 16.dp, top = 4.dp)
            )
        }
    }
}
```

### 4.2 选择器组件

```kotlin
@Composable
fun TodoDropdownSelector<T>(
    value: T,
    onValueChange: (T) -> Unit,
    options: List<T>,
    label: String,
    displayText: (T) -> String,
    modifier: Modifier = Modifier
) {
    var expanded by remember { mutableStateOf(false) }

    ExposedDropdownMenuBox(
        expanded = expanded,
        onExpandedChange = { expanded = !expanded },
        modifier = modifier
    ) {
        OutlinedTextField(
            value = displayText(value),
            onValueChange = {},
            readOnly = true,
            label = { Text(label) },
            trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = expanded) },
            modifier = Modifier
                .menuAnchor()
                .fillMaxWidth()
        )

        ExposedDropdownMenu(
            expanded = expanded,
            onDismissRequest = { expanded = false }
        ) {
            options.forEach { option ->
                DropdownMenuItem(
                    text = { Text(displayText(option)) },
                    onClick = {
                        onValueChange(option)
                        expanded = false
                    }
                )
            }
        }
    }
}
```

## 5. 布局组件

### 5.1 空状态组件

```kotlin
@Composable
fun TodoEmptyState(
    icon: ImageVector,
    title: String,
    description: String,
    actionText: String? = null,
    onAction: (() -> Unit)? = null,
    modifier: Modifier = Modifier
) {
    Column(
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center,
        modifier = modifier.padding(32.dp)
    ) {
        Icon(
            imageVector = icon,
            contentDescription = null,
            tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.4f),
            modifier = Modifier.size(64.dp)
        )

        Spacer(modifier = Modifier.height(16.dp))

        Text(
            text = title,
            style = MaterialTheme.typography.headlineSmall,
            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f),
            textAlign = TextAlign.Center
        )

        Spacer(modifier = Modifier.height(8.dp))

        Text(
            text = description,
            style = MaterialTheme.typography.bodyMedium,
            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.4f),
            textAlign = TextAlign.Center
        )

        if (actionText != null && onAction != null) {
            Spacer(modifier = Modifier.height(24.dp))

            Button(onClick = onAction) {
                Text(actionText)
            }
        }
    }
}
```

### 5.2 加载状态组件

```kotlin
@Composable
fun TodoLoadingState(
    message: String = "加载中...",
    modifier: Modifier = Modifier
) {
    Column(
        horizontalAlignment = Alignment.CenterHorizontally,
        verticalArrangement = Arrangement.Center,
        modifier = modifier.padding(32.dp)
    ) {
        CircularProgressIndicator()

        Spacer(modifier = Modifier.height(16.dp))

        Text(
            text = message,
            style = MaterialTheme.typography.bodyMedium,
            color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)
        )
    }
}
```

## 6. 动画组件

### 6.1 完成动画

```kotlin
@Composable
fun TodoCompleteAnimation(
    isCompleted: Boolean,
    content: @Composable () -> Unit
) {
    val scale by animateFloatAsState(
        targetValue = if (isCompleted) 0.95f else 1f,
        animationSpec = spring(dampingRatio = Spring.DampingRatioMediumBouncy)
    )

    val alpha by animateFloatAsState(
        targetValue = if (isCompleted) 0.6f else 1f,
        animationSpec = tween(300)
    )

    Box(
        modifier = Modifier
            .scale(scale)
            .alpha(alpha)
    ) {
        content()
    }
}
```

### 6.2 滑动删除组件

```kotlin
@Composable
fun TodoSwipeToAction(
    onSwipeLeft: (() -> Unit)? = null,
    onSwipeRight: (() -> Unit)? = null,
    leftActionIcon: ImageVector = Icons.Default.Delete,
    rightActionIcon: ImageVector = Icons.Default.Check,
    leftActionColor: Color = TodoColors.Error,
    rightActionColor: Color = TodoColors.Success,
    content: @Composable () -> Unit
) {
    // SwipeToDismiss 实现
    // 左滑显示删除，右滑显示完成
}
```

## 7. 主题扩展

### 7.1 颜色扩展

```kotlin
val TodoPriority.color: Color
    get() = when (this) {
        TodoPriority.LOW -> TodoColors.PriorityLow
        TodoPriority.NORMAL -> TodoColors.PriorityNormal
        TodoPriority.HIGH -> TodoColors.PriorityHigh
        TodoPriority.URGENT -> TodoColors.PriorityUrgent
    }

val TodoCategory.color: Color
    get() = when (this) {
        TodoCategory.WORK -> TodoColors.CategoryWork
        TodoCategory.PERSONAL -> TodoColors.CategoryPersonal
        TodoCategory.HEALTH -> TodoColors.CategoryHealth
        TodoCategory.STUDY -> TodoColors.CategoryStudy
        TodoCategory.SHOPPING -> TodoColors.CategoryShopping
        TodoCategory.GENERAL -> TodoColors.CategoryGeneral
        TodoCategory.TRAVEL -> Color(0xFF795548)
        TodoCategory.CUSTOM -> Color(0xFF607D8B)
    }
```

### 7.2 显示名称扩展

```kotlin
val TodoPriority.displayName: String
    get() = when (this) {
        TodoPriority.LOW -> "低"
        TodoPriority.NORMAL -> "普通"
        TodoPriority.HIGH -> "高"
        TodoPriority.URGENT -> "紧急"
    }

val TodoCategory.displayName: String
    get() = when (this) {
        TodoCategory.WORK -> "工作"
        TodoCategory.PERSONAL -> "个人"
        TodoCategory.HEALTH -> "健康"
        TodoCategory.STUDY -> "学习"
        TodoCategory.SHOPPING -> "购物"
        TodoCategory.TRAVEL -> "旅行"
        TodoCategory.GENERAL -> "一般"
        TodoCategory.CUSTOM -> "自定义"
    }

val TodoStatus.displayName: String
    get() = when (this) {
        TodoStatus.PENDING -> "待完成"
        TodoStatus.COMPLETED -> "已完成"
        TodoStatus.OVERDUE -> "已过期"
        TodoStatus.SNOOZED -> "已推迟"
        TodoStatus.CANCELLED -> "已取消"
    }
```

## 8. 工具函数

### 8.1 时间格式化

```kotlin
object TodoTimeUtils {
    fun formatTime(timestamp: Long, is24Hour: Boolean = true): String {
        val format = if (is24Hour) "HH:mm" else "hh:mm a"
        return SimpleDateFormat(format, Locale.getDefault()).format(Date(timestamp))
    }

    fun formatDate(timestamp: Long): String {
        return SimpleDateFormat("yyyy-MM-dd", Locale.getDefault()).format(Date(timestamp))
    }

    fun formatDateTime(timestamp: Long, is24Hour: Boolean = true): String {
        val timeFormat = if (is24Hour) "HH:mm" else "hh:mm a"
        val format = "MM-dd $timeFormat"
        return SimpleDateFormat(format, Locale.getDefault()).format(Date(timestamp))
    }

    fun getRelativeTimeString(timestamp: Long): String {
        // 相对时间计算逻辑
    }
}
```

## 9. 组件使用示例

```kotlin
@Composable
fun TodoComponentShowcase() {
    LazyColumn(
        verticalArrangement = Arrangement.spacedBy(16.dp),
        contentPadding = PaddingValues(16.dp)
    ) {
        item {
            Text("标签组件", style = MaterialTheme.typography.titleMedium)
            Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {
                TodoPriorityChip(TodoPriority.HIGH)
                TodoCategoryChip(TodoCategory.WORK)
                TodoStatusChip(TodoStatus.PENDING)
            }
        }

        item {
            Text("按钮组件", style = MaterialTheme.typography.titleMedium)
            Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {
                TodoCompleteButton(false, {})
                TodoSnoozeButton({})
            }
        }

        item {
            Text("指示器组件", style = MaterialTheme.typography.titleMedium)
            Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {
                TodoStatusIndicator(TodoStatus.OVERDUE)
                TodoPriorityIndicator(TodoPriority.URGENT)
            }
        }
    }
}
```

## 10. 总结

UI组件库设计要点：

1. **一致性**: 统一的设计风格和交互模式
2. **可复用**: 组件化设计，便于维护和扩展
3. **可配置**: 支持不同尺寸、颜色和状态
4. **可访问**: 支持无障碍功能
5. **性能**: 优化渲染性能，避免不必要的重组

这个组件库为待办功能提供了完整的UI构建基础。